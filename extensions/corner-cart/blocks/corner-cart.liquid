<script>
  window.__optimaioMoneyFormat = {{ shop.money_format | json }};
  window.__CUSTOMER_ID__ = "{{ customer.id | default: '' }}";
window.__CUSTOMER_EMAIL__ = "{{ customer.email | default: '' }}";
</script>
{% comment %} <script src="https://releases-reconstruction-port-between.trycloudflare.com/campaign.js?shop={{ shop.permanent_domain }}"></script> {% endcomment %}
<script>
window.__SHOP_DOMAIN__ = "{{ shop.permanent_domain }}";
</script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    console.log("Loaded campaign:", window.DYNAMIC_CAMPAIGN);
    console.log("Shop id:", "{{ shop.permanent_domain }}");
window.__SHOP_DOMAIN__ = "{{ shop.permanent_domain }}";

  });
</script> 

{% comment %} <script>
window.__OPTIMIAO_CAMPAIGN_CACHE__ = { data: null, time: 0, pending: null };

async function getCampaignDataCached() {
  const now = Date.now();

  // prevent multiple parallel fetches
  if (window.__OPTIMIAO_CAMPAIGN_CACHE__.pending) {
    return window.__OPTIMIAO_CAMPAIGN_CACHE__.pending;
  }

  // 30 sec cache (ENABLE THIS ‚Äî you can lower to 5s for testing)
  if (window.__OPTIMIAO_CAMPAIGN_CACHE__.data &&
      now - window.__OPTIMIAO_CAMPAIGN_CACHE__.time < 5000) {
    return window.__OPTIMIAO_CAMPAIGN_CACHE__.data;
  }

  // Start a SINGLE fetch
  window.__OPTIMIAO_CAMPAIGN_CACHE__.pending = fetch("/apps/optimaio-cart/activeCampaigns", {
    cache: "no-store",
  })
    .then(r => r.json())
    .then(data => {
      window.__OPTIMIAO_CAMPAIGN_CACHE__.data = data;
      window.__OPTIMIAO_CAMPAIGN_CACHE__.time = Date.now();
      window.__OPTIMIAO_CAMPAIGN_CACHE__.pending = null;
      return data;
    })
    .catch(err => {
      window.__OPTIMIAO_CAMPAIGN_CACHE__.pending = null;
      throw err;
    });

  return window.__OPTIMIAO_CAMPAIGN_CACHE__.pending;
}
</script> {% endcomment %}




<script src="{{ 'optimaio.js' | asset_url }}" defer></script>
 
 {% assign style = 'coolj' %}

{{ 'optimaio-core.css' | asset_url | stylesheet_tag }}

{% case style %}
  {% when 'cool' %}
    {{ 'optimaio-theme-cool.css' | asset_url | stylesheet_tag }}
    {% when 'dark' %}
    {{ 'optimaio-theme-dark.css' | asset_url | stylesheet_tag }}
  {% else %}
    {{ 'optimaio-theme-minimal.css' | asset_url | stylesheet_tag }}
{% endcase %}

 
<!-- Optimaio Universal Responsive Cart Drawer -->
<div id="optimaio-corner-cart">
  üõí <span id="optimaio-corner-cart-count">0</span>
</div>
 
<div id="optimaio-cart-drawer" class="optimaio-cart-drawer" data-active-tab="cart">
  <!-- Header -->
  <div class="optimaio-cart-drawer__header">
    <h2>My Cart</h2>
    <button type="button" class="optimaio-cart-drawer__close">√ó</button>
  </div>
 
  <!-- Middle Scrollable Body -->
  <div class="optimaio-cart-drawer__middle">
 
    <!-- TAB: CART -->
    <div class="optimaio-cart-tab optimaio-cart-tab--cart" data-tab="cart">
      {% render 'optimaio-progress-bar' %}

 

      <div class="optimaio-cart-drawer__items"></div>
 
      <div class="optimaio-cart-drawer__empty" style="display:none;">
        <p>Your cart is empty</p>
        <a href="/" class="optimaio-continue-btn">Continue Shopping</a>
      </div>
 
      <div class="optimaio-cart-drawer__recommendations">
        <h3>You might also like</h3>
        <div class="optimaio-recommendations-list"></div>
      </div>
    </div>
 
    <!-- TAB: OFFERS -->
    <div class="optimaio-cart-tab optimaio-cart-tab--offers" data-tab="offers">
      {% render 'optimaio-offers' %}
    </div>
  </div>
 
  <!-- Footer Summary -->
  <div class="optimaio-cart-drawer__summary-checkout">
    <div class="optimaio-cart-drawer__summary">
      <div class="optimaio-discount-row">
        <span class="optimaio-discount-label">Discount:</span>
        <span class="optimaio-discount-amount">‚Çπ0</span>
      </div>
      <div class="optimaio-total-row">
        <span class="optimaio-total-label">Total:</span>
        <span class="optimaio-total-amount">‚Çπ0</span>
      </div>
    </div>
    <button onclick="window.location='/checkout'" class="optimaio-checkout-btn">Proceed to Checkout</button>
  </div>
 
  <!-- Footer Tabs -->
  <div class="optimaio-cart-drawer__footer">
    <button class="optimaio-tab-btn active" data-target="cart">üõí Cart</button>
    <button class="optimaio-tab-btn" data-target="offers">üéÅ Offers</button>
  </div>
</div>
 



<script src="{{ 'free-gift.js' | asset_url }}" defer></script>

<script src="{{ 'bxgy.js' | asset_url }}" defer></script> 

<style>
  /* ‚ú® Placeholder shimmer for pending free gift */
.optimaio-gift-placeholder {
  opacity: 0.85;
  position: relative;
  overflow: hidden;
}
.optimaio-gift-placeholder::after {
  content: "";
  position: absolute;
  top: 0; left: -150px;
  width: 100px; height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
  animation: optimaio-shimmer 1.2s infinite;
}
@keyframes optimaio-shimmer {
  100% { left: 150%; }
}

</style>
 

 
{% schema %}
{
"name": "Optimaio Corner Cart",
"target": "body",
"settings": []
}
{% endschema %}
 